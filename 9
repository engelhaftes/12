-- Создание базы данных
CREATE DATABASE InvestmentCompanyDB;
USE InvestmentCompanyDB;

-- Таблицы

CREATE TABLE Investors (
    InvestorID INT IDENTITY(1,1) PRIMARY KEY,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    Email NVARCHAR(100),
    Phone NVARCHAR(20)
);

CREATE TABLE Portfolios (
    PortfolioID INT IDENTITY(1,1) PRIMARY KEY,
    InvestorID INT FOREIGN KEY REFERENCES Investors(InvestorID),
    PortfolioName NVARCHAR(100),
    CreationDate DATE
);

CREATE TABLE Assets (
    AssetID INT IDENTITY(1,1) PRIMARY KEY,
    AssetName NVARCHAR(150) NOT NULL,
    AssetType NVARCHAR(100),
    CurrentPrice DECIMAL(18,4)
);

CREATE TABLE PortfolioAssets (
    PortfolioID INT FOREIGN KEY REFERENCES Portfolios(PortfolioID),
    AssetID INT FOREIGN KEY REFERENCES Assets(AssetID),
    Quantity DECIMAL(18,4),
    PRIMARY KEY (PortfolioID, AssetID)
);

CREATE TABLE Transactions (
    TransactionID INT IDENTITY(1,1) PRIMARY KEY,
    PortfolioID INT FOREIGN KEY REFERENCES Portfolios(PortfolioID),
    AssetID INT FOREIGN KEY REFERENCES Assets(AssetID),
    TransactionDate DATE,
    TransactionType NVARCHAR(20), -- 'Buy' или 'Sell'
    Quantity DECIMAL(18,4),
    Price DECIMAL(18,4)
);

-- Тестовые данные

INSERT INTO Investors (FirstName, LastName, Email, Phone) VALUES
('Сергей', 'Власов', 'sergey.vlasov@example.com', '+79990001111'),
('Анна', 'Михайлова', 'anna.mikhaylova@example.com', '+79990002222');

INSERT INTO Portfolios (InvestorID, PortfolioName, CreationDate) VALUES
(1, 'Основной портфель', '2023-05-01'),
(2, 'Резервный портфель', '2024-01-15');

INSERT INTO Assets (AssetName, AssetType, CurrentPrice) VALUES
('Акции Газпром', 'Акции', 245.75),
('Облигации гос. Россия', 'Облигации', 101.25),
('Золото', 'Товар', 1850.30);

INSERT INTO PortfolioAssets VALUES
(1, 1, 1000),
(1, 3, 5),
(2, 2, 200);

INSERT INTO Transactions (PortfolioID, AssetID, TransactionDate, TransactionType, Quantity, Price) VALUES
(1, 1, '2025-01-20', 'Buy', 1000, 240.00),
(1, 3, '2025-02-10', 'Buy', 5, 1800.00),
(2, 2, '2025-03-05', 'Buy', 200, 100.50);
